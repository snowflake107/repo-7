"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[30899],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var m=a.createContext({}),d=function(e){var t=a.useContext(m),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(m.Provider,{value:t},e.children)},s="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,m=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),s=d(n),c=r,k=s["".concat(m,".").concat(c)]||s[c]||u[c]||l;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=c;var o={};for(var m in t)hasOwnProperty.call(t,m)&&(o[m]=t[m]);o.originalType=e,o[s]="string"==typeof e?e:r,i[1]=o;for(var d=2;d<l;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},15156:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var a=n(87462),r=(n(67294),n(3905));const l={sidebar_position:1},i="Telemetry",o={unversionedId:"learn/advanced/telemetry",id:"learn/advanced/telemetry",title:"Telemetry",description:"Gather relevant insights about your application and modules with custom metrics and telemetry.",source:"@site/docs/learn/advanced/09-telemetry.md",sourceDirName:"learn/advanced",slug:"/learn/advanced/telemetry",permalink:"/main/learn/advanced/telemetry",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"learnSidebar",previous:{title:"Events",permalink:"/main/learn/advanced/events"},next:{title:"Object-Capability Model",permalink:"/main/learn/advanced/ocap"}},m={},d=[{value:"Emitting metrics",id:"emitting-metrics",level:2},{value:"Labels",id:"labels",level:2},{value:"Cardinality",id:"cardinality",level:2},{value:"Idempotency",id:"idempotency",level:2},{value:"Supported Metrics",id:"supported-metrics",level:2}],p={toc:d},s="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(s,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"telemetry"},"Telemetry"),(0,r.kt)("admonition",{title:"Synopsis",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Gather relevant insights about your application and modules with custom metrics and telemetry.")),(0,r.kt)("p",null,"The Cosmos SDK enables operators and developers to gain insight into the performance and behavior of\ntheir application through the use of the ",(0,r.kt)("inlineCode",{parentName:"p"},"telemetry")," package. To enable telemetrics, set ",(0,r.kt)("inlineCode",{parentName:"p"},"telemetry.enabled = true")," in the app.toml config file."),(0,r.kt)("p",null,"The Cosmos SDK currently supports enabling in-memory and prometheus as telemetry sinks. In-memory sink is always attached (when the telemetry is enabled) with 10 second interval and 1 minute retention. This means that metrics will be aggregated over 10 seconds, and metrics will be kept alive for 1 minute."),(0,r.kt)("p",null,"To query active metrics (see retention note above) you have to enable API server (",(0,r.kt)("inlineCode",{parentName:"p"},"api.enabled = true")," in the app.toml). Single API endpoint is exposed: ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:1317/metrics?format={text|prometheus}")," (or port ",(0,r.kt)("inlineCode",{parentName:"p"},"1318")," in v2) , the default being ",(0,r.kt)("inlineCode",{parentName:"p"},"text"),"."),(0,r.kt)("h2",{id:"emitting-metrics"},"Emitting metrics"),(0,r.kt)("p",null,"If telemetry is enabled via configuration, a single global metrics collector is registered via the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/hashicorp/go-metrics"},"go-metrics")," library. This allows emitting and collecting\nmetrics through simple ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/v0.50.10/telemetry/wrapper.go"},"API"),". Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"func EndBlocker(ctx sdk.Context, k keeper.Keeper) {\n  start := telemetry.Now()\n  defer telemetry.ModuleMeasureSince(types.ModuleName, start, telemetry.MetricKeyEndBlocker)\n\n  // ...\n}\n")),(0,r.kt)("p",null,"Developers may use the ",(0,r.kt)("inlineCode",{parentName:"p"},"telemetry")," package directly, which provides wrappers around metric APIs\nthat include adding useful labels, or they must use the ",(0,r.kt)("inlineCode",{parentName:"p"},"go-metrics")," library directly. It is preferable\nto add as much context and adequate dimensionality to metrics as possible, so the ",(0,r.kt)("inlineCode",{parentName:"p"},"telemetry")," package\nis advised. Regardless of the package or method used, the Cosmos SDK supports the following metrics\ntypes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"gauges"),(0,r.kt)("li",{parentName:"ul"},"summaries"),(0,r.kt)("li",{parentName:"ul"},"counters")),(0,r.kt)("h2",{id:"labels"},"Labels"),(0,r.kt)("p",null,"Certain components of modules will have their name automatically added as a label (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"BeginBlock"),").\nOperators may also supply the application with a global set of labels that will be applied to all\nmetrics emitted using the ",(0,r.kt)("inlineCode",{parentName:"p"},"telemetry")," package (e.g. chain-id). Global labels are supplied as a list\nof ","[name, value]"," tuples."),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-toml"},'global-labels = [\n  ["chain_id", "chain-OfXo4V"],\n]\n')),(0,r.kt)("h2",{id:"cardinality"},"Cardinality"),(0,r.kt)("p",null,"Cardinality is key, specifically label and key cardinality. Cardinality is how many unique values of\nsomething there are. So there is naturally a tradeoff between granularity and how much stress is put\non the telemetry sink in terms of indexing, scrape, and query performance."),(0,r.kt)("p",null,"Developers should take care to support metrics with enough dimensionality and granularity to be\nuseful, but not increase the cardinality beyond the sink's limits. A general rule of thumb is to not\nexceed a cardinality of 10."),(0,r.kt)("p",null,"Consider the following examples with enough granularity and adequate cardinality:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"begin/end blocker time"),(0,r.kt)("li",{parentName:"ul"},"tx gas used"),(0,r.kt)("li",{parentName:"ul"},"block gas used")),(0,r.kt)("p",null,"The following examples expose too much cardinality and may not even prove to be useful:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"transfers between accounts with amount"),(0,r.kt)("li",{parentName:"ul"},"voting/deposit amount from unique addresses")),(0,r.kt)("h2",{id:"idempotency"},"Idempotency"),(0,r.kt)("p",null,"Metrics aren't idempotent, so if a metric is emitted twice, it will be counted twice.\nThis is important to keep in mind when collecting metrics. If a module is called twice, the metrics will be emitted twice (for instance in ",(0,r.kt)("inlineCode",{parentName:"p"},"CheckTx"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"SimulateTx")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"DeliverTx"),")."),(0,r.kt)("h2",{id:"supported-metrics"},"Supported Metrics"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Metric"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Unit"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tx_count")),(0,r.kt)("td",{parentName:"tr",align:null},"Total number of txs processed via ",(0,r.kt)("inlineCode",{parentName:"td"},"DeliverTx")),(0,r.kt)("td",{parentName:"tr",align:null},"tx"),(0,r.kt)("td",{parentName:"tr",align:null},"counter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tx_successful")),(0,r.kt)("td",{parentName:"tr",align:null},"Total number of successful txs processed via ",(0,r.kt)("inlineCode",{parentName:"td"},"DeliverTx")),(0,r.kt)("td",{parentName:"tr",align:null},"tx"),(0,r.kt)("td",{parentName:"tr",align:null},"counter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tx_failed")),(0,r.kt)("td",{parentName:"tr",align:null},"Total number of failed txs processed via ",(0,r.kt)("inlineCode",{parentName:"td"},"DeliverTx")),(0,r.kt)("td",{parentName:"tr",align:null},"tx"),(0,r.kt)("td",{parentName:"tr",align:null},"counter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tx_gas_used")),(0,r.kt)("td",{parentName:"tr",align:null},"The total amount of gas used by a tx"),(0,r.kt)("td",{parentName:"tr",align:null},"gas"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tx_gas_wanted")),(0,r.kt)("td",{parentName:"tr",align:null},"The total amount of gas requested by a tx"),(0,r.kt)("td",{parentName:"tr",align:null},"gas"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"store_iavl_get")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration of an IAVL ",(0,r.kt)("inlineCode",{parentName:"td"},"Store#Get")," call"),(0,r.kt)("td",{parentName:"tr",align:null},"ms"),(0,r.kt)("td",{parentName:"tr",align:null},"summary")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"store_iavl_set")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration of an IAVL ",(0,r.kt)("inlineCode",{parentName:"td"},"Store#Set")," call"),(0,r.kt)("td",{parentName:"tr",align:null},"ms"),(0,r.kt)("td",{parentName:"tr",align:null},"summary")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"store_iavl_has")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration of an IAVL ",(0,r.kt)("inlineCode",{parentName:"td"},"Store#Has")," call"),(0,r.kt)("td",{parentName:"tr",align:null},"ms"),(0,r.kt)("td",{parentName:"tr",align:null},"summary")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"store_iavl_delete")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration of an IAVL ",(0,r.kt)("inlineCode",{parentName:"td"},"Store#Delete")," call"),(0,r.kt)("td",{parentName:"tr",align:null},"ms"),(0,r.kt)("td",{parentName:"tr",align:null},"summary")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"store_iavl_commit")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration of an IAVL ",(0,r.kt)("inlineCode",{parentName:"td"},"Store#Commit")," call"),(0,r.kt)("td",{parentName:"tr",align:null},"ms"),(0,r.kt)("td",{parentName:"tr",align:null},"summary")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"store_iavl_query")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration of an IAVL ",(0,r.kt)("inlineCode",{parentName:"td"},"Store#Query")," call"),(0,r.kt)("td",{parentName:"tr",align:null},"ms"),(0,r.kt)("td",{parentName:"tr",align:null},"summary")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"begin_blocker")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration of the ",(0,r.kt)("inlineCode",{parentName:"td"},"BeginBlock")," call per module"),(0,r.kt)("td",{parentName:"tr",align:null},"ms"),(0,r.kt)("td",{parentName:"tr",align:null},"summary")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"end_blocker")),(0,r.kt)("td",{parentName:"tr",align:null},"Duration of the ",(0,r.kt)("inlineCode",{parentName:"td"},"EndBlock")," call per module"),(0,r.kt)("td",{parentName:"tr",align:null},"ms"),(0,r.kt)("td",{parentName:"tr",align:null},"summary")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"server_info")),(0,r.kt)("td",{parentName:"tr",align:null},"Information about the server, such as version, commit, and build date, upgrade"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"gauge")))))}u.isMDXComponent=!0}}]);