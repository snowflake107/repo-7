"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[67995],{3905:(e,t,o)=>{o.d(t,{Zo:()=>d,kt:()=>h});var a=o(67294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function r(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)o=i[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)o=i[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var l=a.createContext({}),p=function(e){var t=a.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):s(s({},t),e)),o},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var o=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),c=p(o),u=n,h=c["".concat(l,".").concat(u)]||c[u]||m[u]||i;return o?a.createElement(h,s(s({ref:t},d),{},{components:o})):a.createElement(h,s({ref:t},d))}));function h(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=o.length,s=new Array(i);s[0]=u;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r[c]="string"==typeof e?e:n,s[1]=r;for(var p=2;p<i;p++)s[p]=o[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,o)}u.displayName="MDXCreateElement"},77526:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>p});var a=o(87462),n=(o(67294),o(3905));const i={},s="ADR 069: x/gov modularity, multiple choice and optimistic proposals",r={unversionedId:"build/architecture/adr-069-gov-improvements",id:"version-0.52/build/architecture/adr-069-gov-improvements",title:"ADR 069: x/gov modularity, multiple choice and optimistic proposals",description:"Changelog",source:"@site/versioned_docs/version-0.52/build/architecture/adr-069-gov-improvements.md",sourceDirName:"build/architecture",slug:"/build/architecture/adr-069-gov-improvements",permalink:"/v0.52/build/architecture/adr-069-gov-improvements",draft:!1,tags:[],version:"0.52",frontMatter:{},sidebar:"buildSidebar",previous:{title:"ADR 068: Preblock",permalink:"/v0.52/build/architecture/adr-068-preblock"},next:{title:"ADR 070: Unordered Transactions",permalink:"/v0.52/build/architecture/adr-070-unordered-transactions"}},l={},p=[{value:"Changelog",id:"changelog",level:2},{value:"Status",id:"status",level:2},{value:"Abstract",id:"abstract",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Proposals",id:"proposals",level:3},{value:"Optimistic Proposal",id:"optimistic-proposal",level:4},{value:"Multiple Choice Proposal",id:"multiple-choice-proposal",level:4},{value:"Votes",id:"votes",level:3},{value:"Tally",id:"tally",level:4},{value:"Consequences",id:"consequences",level:2},{value:"Backwards Compatibility",id:"backwards-compatibility",level:3},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3},{value:"Further Discussions",id:"further-discussions",level:2},{value:"References",id:"references",level:2}],d={toc:p},c="wrapper";function m(e){let{components:t,...o}=e;return(0,n.kt)(c,(0,a.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"adr-069-xgov-modularity-multiple-choice-and-optimistic-proposals"},"ADR 069: ",(0,n.kt)("inlineCode",{parentName:"h1"},"x/gov")," modularity, multiple choice and optimistic proposals"),(0,n.kt)("h2",{id:"changelog"},"Changelog"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"2023-11-17: Initial draft (@julienrbrt, @tac0turtle)")),(0,n.kt)("h2",{id:"status"},"Status"),(0,n.kt)("p",null,"ACCEPTED - Implemented"),(0,n.kt)("h2",{id:"abstract"},"Abstract"),(0,n.kt)("p",null,"Governance is an important aspect of Cosmos SDK chains."),(0,n.kt)("p",null,"This ADR aimed to extend the ",(0,n.kt)("inlineCode",{parentName:"p"},"x/gov")," module functionalities by adding two different kinds of proposals, as well as making ",(0,n.kt)("inlineCode",{parentName:"p"},"x/gov")," more composable and extendable."),(0,n.kt)("p",null,"Those two types are, namely: multiple choice proposals and optimistic proposals."),(0,n.kt)("h2",{id:"context"},"Context"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"x/gov")," is the center of Cosmos governance, and has already been improved from its first version ",(0,n.kt)("inlineCode",{parentName:"p"},"v1beta1"),", with a second version ",(0,n.kt)("a",{parentName:"p",href:"https://buf.build/cosmos/cosmos-sdk/docs/main:cosmos.gov.v1"},(0,n.kt)("inlineCode",{parentName:"a"},"v1")),".\nThis second iteration of gov unlocked many possibilities by letting governance proposals contain any number of proposals.\nThe last addition of gov has been expedited proposals (proposals that have a shorter voting period and a higher quorum, approval threshold)."),(0,n.kt)("p",null,"The community requested (",(0,n.kt)("a",{parentName:"p",href:"https://grants.osmosis.zone/blog/rfp-cosmos-sdk-governance-module-improvements"},"1"),", ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/decentralists/DAO/issues/28"},"4"),") two additional proposals for improving governance choices. Those proposals would be useful when having protocol decisions made on specific choices or simplifying regular proposals that do not require high community involvement."),(0,n.kt)("p",null,"Additionally, the SDK should allow chains to customize the tallying method of proposals (if they want to count the votes in another way). Currently, the Cosmos SDK counts votes proportionally to the voting power/stake. However, custom tallying could allow counting votes with a quadratic function instead."),(0,n.kt)("h2",{id:"decision"},"Decision"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"x/gov")," will integrate these functions and extract helpers and interfaces for extending the ",(0,n.kt)("inlineCode",{parentName:"p"},"x/gov")," module capabilities."),(0,n.kt)("h3",{id:"proposals"},"Proposals"),(0,n.kt)("p",null,"Currently, all proposals are ",(0,n.kt)("a",{parentName:"p",href:"https://buf.build/cosmos/cosmos-sdk/docs/main:cosmos.gov.v1"},(0,n.kt)("inlineCode",{parentName:"a"},"v1.Proposal")),". Optimistic and multiple choice proposals require a different tally logic, but the rest of the proposal stays the same to not create other proposal types, ",(0,n.kt)("inlineCode",{parentName:"p"},"v1.Proposal")," will have an extra field:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-protobuf"},"// ProposalType enumerates the valid proposal types.\n// All proposal types are v1.Proposal which have different voting periods or tallying logic.\nenum ProposalType {\n  // PROPOSAL_TYPE_UNSPECIFIED defines no proposal type, which fallback to PROPOSAL_TYPE_STANDARD.\n  PROPOSAL_TYPE_UNSPECIFIED = 0;\n  // PROPOSAL_TYPE_STANDARD defines the type for a standard proposal.\n  PROPOSAL_TYPE_STANDARD = 1;\n  // PROPOSAL_TYPE_MULTIPLE_CHOICE defines the type for a multiple choice proposal.\n  PROPOSAL_TYPE_MULTIPLE_CHOICE = 2;\n  // PROPOSAL_TYPE_OPTIMISTIC defines the type for an optimistic proposal.\n  PROPOSAL_TYPE_OPTIMISTIC = 3;\n  // PROPOSAL_TYPE_EXPEDITED defines the type for an expedited proposal.\n  PROPOSAL_TYPE_EXPEDITED = 4;\n}\n")),(0,n.kt)("p",null,"Note, that expedited becomes a proposal type itself instead of a boolean on the ",(0,n.kt)("inlineCode",{parentName:"p"},"v1.Proposal")," struct."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"An expedited proposal is by design a standard proposal with a quicker voting period and higher threshold. When an expedited proposal fails, it gets converted to a standard proposal.   ")),(0,n.kt)("p",null,"An expedited optimistic proposal and an expedited multiple choice proposal do not make sense based on the definition above and is a proposal type instead of a proposal characteristic."),(0,n.kt)("h4",{id:"optimistic-proposal"},"Optimistic Proposal"),(0,n.kt)("p",null,"An optimistic proposal is a proposal that passes unless a threshold a NO votes is reached."),(0,n.kt)("p",null,"Voter can only vote NO on the proposal. If the NO threshold is reached, the optimistic proposal is converted to a standard proposal."),(0,n.kt)("p",null,"Two governance parameters will be in added ",(0,n.kt)("a",{parentName:"p",href:"https://buf.build/cosmos/cosmos-sdk/docs/main:cosmos.gov.v1"},(0,n.kt)("inlineCode",{parentName:"a"},"v1.Params"))," to support optimistic proposals:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-protobuf"},'// optimistic_authorized_addreses is an optional governance parameter that limits the authorized accounts that can submit optimistic proposals\nrepeated string optimistic_authorized_addreses = 17 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n\n// Optimistic rejected threshold defines at which percentage of NO votes, the optimistic proposal should fail and be converted to a standard proposal.\nstring optimistic_rejected_threshold = 18 [(cosmos_proto.scalar) = "cosmos.Dec"];\n')),(0,n.kt)("h4",{id:"multiple-choice-proposal"},"Multiple Choice Proposal"),(0,n.kt)("p",null,"A multiple choice proposal is a proposal where the voting options can be defined by the proposer."),(0,n.kt)("p",null,"The number of voting options will be limited to a maximum of 4.\nA new vote option ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM")," will be added and distinguished from those voting options. ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM")," will be used to mark a proposal as spam and is explained further below."),(0,n.kt)("p",null,"Multiple choice proposals, contrary to any other proposal type, cannot have messages to execute. They are only text proposals."),(0,n.kt)("p",null,"Submitting a new multiple choice proposal will use a different message than the ",(0,n.kt)("a",{parentName:"p",href:"https://buf.build/cosmos/cosmos-sdk/docs/main:cosmos.gov.v1"},(0,n.kt)("inlineCode",{parentName:"a"},"v1.MsgSubmitProposal")),". This is done in order to simplify the proposal submission and allow defining the voting options directly."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-protobuf"},'message MsgSubmitMultipleChoiceProposal {\n  repeated cosmos.base.v1beta1.Coin initial_deposit = 1;\n  string proposer = 2 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string metadata = 3;\n  string title = 4;\n  string summary = 5;\n  string option_one = 6;\n  string option_two = 7;\n  string option_three = 8;\n  string option_four = 9;\n}\n')),(0,n.kt)("p",null,"Voters can only vote on the defined options in the proposal."),(0,n.kt)("p",null,"To maintain compatibility with the existing endpoints, the voting options will not be stored in the proposal itself and each option will be mapped to ",(0,n.kt)("a",{parentName:"p",href:"https://buf.build/cosmos/cosmos-sdk/docs/main:cosmos.gov.v1"},(0,n.kt)("inlineCode",{parentName:"a"},"v1.VoteOption")),". A multiple choice proposal will be stored as a ",(0,n.kt)("a",{parentName:"p",href:"https://buf.build/cosmos/cosmos-sdk/docs/main:cosmos.gov.v1"},(0,n.kt)("inlineCode",{parentName:"a"},"v1.Proposal")),". A query will be available for multiple choice proposal types to get the voting options."),(0,n.kt)("h3",{id:"votes"},"Votes"),(0,n.kt)("p",null,"As mentioned above ",(0,n.kt)("a",{parentName:"p",href:"#multiple-choice-proposal"},"multiple choice proposal")," will introduce an additional vote option: ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM"),"."),(0,n.kt)("p",null,"This vote option will be supported by all proposal types.\nAt the end of the voting period, if a proposal is voted as ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM"),", it fails and its deposit is burned."),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"SPAM")," differs from the ",(0,n.kt)("inlineCode",{parentName:"p"},"No with Veto")," vote as its threshold is dynamic.\nA proposal is marked as ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM")," when the total of weighted votes for all options is lower than the amount of weighted vote on ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM"),"\n(",(0,n.kt)("inlineCode",{parentName:"p"},"spam")," > ",(0,n.kt)("inlineCode",{parentName:"p"},"option_one + option_two + option_three + option_four")," = proposal marked as spam).\nThis allows clear spam proposals to be marked as spam easily, even with low participation from validators."),(0,n.kt)("p",null,"To avoid voters wrongfully voting down a proposal as ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM"),", voters will be slashed ",(0,n.kt)("inlineCode",{parentName:"p"},"x"),"% (default 0%) of their voting stake if they voted ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM")," on a proposal that wasn't a spam proposal. The parameter allows to incentivise voters to only vote ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM")," on actual spam proposals and not use ",(0,n.kt)("inlineCode",{parentName:"p"},"SPAM")," as a way to vote ",(0,n.kt)("inlineCode",{parentName:"p"},"No with Veto")," with a different threshold."),(0,n.kt)("p",null,"This leads to the addition of the following governance parameter in ",(0,n.kt)("a",{parentName:"p",href:"https://buf.build/cosmos/cosmos-sdk/docs/main:cosmos.gov.v1"},(0,n.kt)("inlineCode",{parentName:"a"},"v1.Params")),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-protobuf"},'// burn_spam_amount defines the percentage of the voting stake that will be burned if a voter votes SPAM on a proposal that is not marked as SPAM.\nstring burn_spam_amount = 8 [(cosmos_proto.scalar) = "cosmos.Dec"];\n')),(0,n.kt)("p",null,"Additionally, the current vote options will be aliased to better accommodate the multiple choice proposal:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-protobuf"},"// VoteOption enumerates the valid vote options for a given governance proposal.\nenum VoteOption {\n  option allow_alias = true;\n\n  // VOTE_OPTION_UNSPECIFIED defines a no-op vote option.\n  VOTE_OPTION_UNSPECIFIED = 0;\n  // VOTE_OPTION_ONE defines the first proposal vote option.\n  VOTE_OPTION_ONE = 1;\n  // VOTE_OPTION_YES defines the yes proposal vote option.\n  VOTE_OPTION_YES = 1;\n  // VOTE_OPTION_TWO defines the second proposal vote option.\n  VOTE_OPTION_TWO = 2;\n  // VOTE_OPTION_ABSTAIN defines the abstain proposal vote option.\n  VOTE_OPTION_ABSTAIN = 2;\n  // VOTE_OPTION_THREE defines the third proposal vote option.\n  VOTE_OPTION_THREE = 3;\n  // VOTE_OPTION_NO defines the no proposal vote option.\n  VOTE_OPTION_NO = 3;\n  // VOTE_OPTION_FOUR defines the fourth proposal vote option.\n  VOTE_OPTION_FOUR = 4;\n  // VOTE_OPTION_NO_WITH_VETO defines the no with veto proposal vote option.\n  VOTE_OPTION_NO_WITH_VETO = 4;\n  // VOTE_OPTION_SPAM defines the spam proposal vote option.\n  VOTE_OPTION_SPAM = 5;\n}\n")),(0,n.kt)("p",null,"The order does not change for a standard proposal (1 = yes, 2 = abstain, 3 = no, 4 = no with veto as it was) and the aliased enum can be used interchangeably."),(0,n.kt)("p",null,"Updating vote options means updating ",(0,n.kt)("a",{parentName:"p",href:"https://buf.build/cosmos/cosmos-sdk/docs/main:cosmos.gov.v1"},(0,n.kt)("inlineCode",{parentName:"a"},"v1.TallyResult"))," as well."),(0,n.kt)("h4",{id:"tally"},"Tally"),(0,n.kt)("p",null,"Due to the vote option change, each proposal can have the same tallying method."),(0,n.kt)("p",null,"However, chains may want to change the tallying function (weighted vote per voting power) of ",(0,n.kt)("inlineCode",{parentName:"p"},"x/gov")," for a different algorithm (using a quadratic function on the voter stake, for instance)."),(0,n.kt)("p",null,"The custom tallying function can be passed to the ",(0,n.kt)("inlineCode",{parentName:"p"},"x/gov")," keeper config:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-go"},"type CalculateVoteResultsAndVotingPowerFn func(\n    ctx context.Context,\n    keeper Keeper,\n    proposalID uint64,\n    validators map[string]v1.ValidatorGovInfo,\n) (totalVoterPower math.LegacyDec, results map[v1.VoteOption]math.LegacyDec, err error)\n")),(0,n.kt)("h2",{id:"consequences"},"Consequences"),(0,n.kt)("p",null,"Changing voting possibilities has a direct consequence for the clients. Clients, like Keplr or Mintscan, need to implement logic for multiple choice proposals."),(0,n.kt)("p",null,"That logic consists of querying multiple choice proposals vote mapping their vote options."),(0,n.kt)("h3",{id:"backwards-compatibility"},"Backwards Compatibility"),(0,n.kt)("p",null,"Legacy proposals (",(0,n.kt)("inlineCode",{parentName:"p"},"v1beta1"),") endpoints will not be supporting the new proposal types."),(0,n.kt)("p",null,"Voting on a gov v1 proposal having a different type than ",(0,n.kt)("a",{parentName:"p",href:"#proposals"},(0,n.kt)("inlineCode",{parentName:"a"},"standard")," or ",(0,n.kt)("inlineCode",{parentName:"a"},"expedited"))," via the ",(0,n.kt)("inlineCode",{parentName:"p"},"v1beta1")," will not be supported.\nThis is already the case for the expedited proposals."),(0,n.kt)("h3",{id:"positive"},"Positive"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Extended governance features"),(0,n.kt)("li",{parentName:"ul"},"Extended governance customization")),(0,n.kt)("h3",{id:"negative"},"Negative"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Increase gov wiring complexity")),(0,n.kt)("h3",{id:"neutral"},"Neutral"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Increases the number of parameters available")),(0,n.kt)("h2",{id:"further-discussions"},"Further Discussions"),(0,n.kt)("p",null,"This ADR starts the ",(0,n.kt)("inlineCode",{parentName:"p"},"x/gov")," overhaul for the ",(0,n.kt)("inlineCode",{parentName:"p"},"cosmossdk.io/x/gov")," v1.0.0 release.\nFurther internal improvements of ",(0,n.kt)("inlineCode",{parentName:"p"},"x/gov"),' will happen soon after, in order to simplify its state management and making gov calculation in a more "lazy"-fashion.'),(0,n.kt)("p",null,"Those improvements may change the tallying api."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/issues/16270"},"https://github.com/cosmos/cosmos-sdk/issues/16270"))),(0,n.kt)("h2",{id:"references"},"References"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://grants.osmosis.zone/blog/rfp-cosmos-sdk-governance-module-improvements"},"https://github.com/cosmos/cosmos-sdk/issues/16270")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/issues/17781"},"https://github.com/cosmos/cosmos-sdk/issues/17781")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/cosmos/cosmos-sdk/issues/14403"},"https://github.com/cosmos/cosmos-sdk/issues/14403")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/decentralists/DAO/issues/28"},"https://github.com/decentralists/DAO/issues/28"))))}m.isMDXComponent=!0}}]);